(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var FileNavigator;

FileNavigator = function(file, options) {
  var decode, getProgress, lastPosition, navigator, readChunk, self, size;
  self = this;
  size = file.size;
  file.navigator = this;
  lastPosition = 0;
  getProgress = function() {
    var progress;
    if (!size || size === 0) {
      return 0;
    }
    progress = parseInt(100 * lastPosition / size);
    if (progress > 100) {
      return 100;
    } else {
      return progress;
    }
  };
  readChunk = function(offset, length, callback) {
    var reader;
    lastPosition = offset + length;
    reader = new FileReader;
    reader.onloadend = function(progress) {
      var buffer;
      buffer = void 0;
      if (reader.result) {
        buffer = new Int8Array(reader.result, 0);
        buffer.slice = buffer.subarray;
      }
      callback(progress.err, buffer, progress.loaded);
    };
    reader.readAsArrayBuffer(file.slice(offset, offset + length));
  };
  decode = function(buffer, callback) {
    var reader;
    reader = new FileReader;
    reader.onloadend = function(progress) {
      callback(progress.currentTarget.result);
    };
    reader.readAsText(new Blob([buffer]));
  };
  navigator = new LineNavigator(readChunk, decode, options);
  self.getMilestones = navigator.getMilestones;
  self.readSomeLines = function(index, callback) {
    navigator.readSomeLines(index, function(err, index, lines, eof) {
      callback(err, index, lines, eof, getProgress());
    });
  };
  self.readLines = function(index, count, callback) {
    navigator.readLines(index, count, function(err, index, lines, eof) {
      callback(err, index, lines, eof, getProgress());
    });
  };
  self.find = navigator.find;
  self.findAll = navigator.findAll;
  self.getSize = function(callback) {
    return callback(file ? file.size : 0);
  };
};

module.exports = FileNavigator;



},{}],2:[function(require,module,exports){
var FileNavigator, es_client, field_names, file, hosts, indexToStartWith, index_name, init_ui, linesReadHandler, lines_in_batch, navigator, options, prepare_json, process_lines, readFile, send_to_server, show_progress, type_name;

FileNavigator = require('./filenavigator.coffee');

show_progress = function(progress, number) {
  var bar;
  bar = $(".progress-bar");
  bar.css("width", progress + "%");
  bar.text(progress + "%");
  $('#counter').text(number);
  return console.log(number + " : lines " + progress);
};

hosts = "localhost:9200";

index_name = "govwiki";

type_name = "govs";

es_client = void 0;

field_names = [];

navigator = void 0;

file = void 0;

lines_in_batch = 5000;

indexToStartWith = 0;

options = {
  chunkSize: 1024 * 16
};

init_ui = function() {
  file = document.getElementById('chooseFileButton').files[0];
  return show_progress(0, 0);
};

prepare_json = function(index, lines) {
  var field_values, i, instruct, j, len, line, record, res;
  if (!lines) {
    return;
  }
  res = [];
  if (index === 0) {
    field_names = lines[0].replace(/"/g, '').split(',');
    lines.shift();
  }
  for (i = j = 0, len = lines.length; j < len; i = ++j) {
    line = lines[i];
    field_values = line.split(',');
    record = CSV.parse(line, {
      header: field_names,
      cellDelimiter: ','
    });
    instruct = {
      index: {
        _index: index_name,
        _type: type_name,
        _id: i
      }
    };
    res.push(instruct);
    res.push(record);
  }
  return res;
};

send_to_server = function(index, lines, eof, progress, json) {
  setTimeout((function(_this) {
    return function() {
      show_progress(progress, index + lines.length);
      console.log(" " + lines.length + " lines sent");
      if (eof) {
        return;
      }
      navigator.readLines(index + lines.length, lines_in_batch, linesReadHandler);
    };
  })(this), 1000);
};

process_lines = function(index, lines, eof, progress) {
  var json;
  json = prepare_json(index, lines);
  return send_to_server(index, lines, eof, progress, json);
};

linesReadHandler = function(err, index, lines, eof, progress) {
  if (err) {
    return;
  }
  process_lines(index, lines, eof, progress);
};

readFile = function() {
  hosts = $('#hosts').val();
  index_name = $('#indexName').val();
  type_name = $('#typeName').val();
  es_client = new $.es.Client({
    hosts: hosts
  });
  navigator = new FileNavigator(file, options);
  navigator.readLines(indexToStartWith, lines_in_batch, linesReadHandler);
};

$('#chooseFileButton').change((function(_this) {
  return function() {
    return init_ui();
  };
})(this));

$('#readFileButton').click((function(_this) {
  return function() {
    return readFile();
  };
})(this));



},{"./filenavigator.coffee":1}]},{},[2])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy93YXRjaGlmeS9ub2RlX21vZHVsZXMvYnJvd3NlcmlmeS9ub2RlX21vZHVsZXMvYnJvd3Nlci1wYWNrL19wcmVsdWRlLmpzIiwiL1VzZXJzL3ZhZGltaXZsZXYvUHJvamVjdHMvX3Byb2plY3RzL2VsYXN0aWNzZWFyY2gtZGF0YS1sb2FkZXIvY29mZmVlL2ZpbGVuYXZpZ2F0b3IuY29mZmVlIiwiL1VzZXJzL3ZhZGltaXZsZXYvUHJvamVjdHMvX3Byb2plY3RzL2VsYXN0aWNzZWFyY2gtZGF0YS1sb2FkZXIvY29mZmVlL21haW4uY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDUUEsSUFBQSxhQUFBOztBQUFBLGFBQUEsR0FBZ0IsU0FBQyxJQUFELEVBQU8sT0FBUCxHQUFBO0FBQ2QsTUFBQSxtRUFBQTtBQUFBLEVBQUEsSUFBQSxHQUFPLElBQVAsQ0FBQTtBQUFBLEVBQ0EsSUFBQSxHQUFPLElBQUksQ0FBQyxJQURaLENBQUE7QUFBQSxFQUVBLElBQUksQ0FBQyxTQUFMLEdBQWlCLElBRmpCLENBQUE7QUFBQSxFQUlBLFlBQUEsR0FBZSxDQUpmLENBQUE7QUFBQSxFQU1BLFdBQUEsR0FBYyxTQUFBLEdBQUE7QUFDWixRQUFBLFFBQUE7QUFBQSxJQUFBLElBQUcsQ0FBQSxJQUFBLElBQVMsSUFBQSxLQUFRLENBQXBCO0FBQ0UsYUFBTyxDQUFQLENBREY7S0FBQTtBQUFBLElBRUEsUUFBQSxHQUFXLFFBQUEsQ0FBUyxHQUFBLEdBQU0sWUFBTixHQUFxQixJQUE5QixDQUZYLENBQUE7QUFHQSxJQUFBLElBQUcsUUFBQSxHQUFXLEdBQWQ7YUFBdUIsSUFBdkI7S0FBQSxNQUFBO2FBQWdDLFNBQWhDO0tBSlk7RUFBQSxDQU5kLENBQUE7QUFBQSxFQWdCQSxTQUFBLEdBQVksU0FBQyxNQUFELEVBQVMsTUFBVCxFQUFpQixRQUFqQixHQUFBO0FBQ1YsUUFBQSxNQUFBO0FBQUEsSUFBQSxZQUFBLEdBQWUsTUFBQSxHQUFT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QUFaLENBQUEsQ0FBUixDQUFBO0FBQUEsRUFDQSxVQUFBLEdBQWEsQ0FBQSxDQUFFLFlBQUYsQ0FBZSxDQUFDLEdBQWhCLENBQUEsQ0FEYixDQUFBO0FBQUEsRUFFQSxTQUFBLEdBQVksQ0FBQSxDQUFFLFdBQUYsQ0FBYyxDQUFDLEdBQWYsQ0FBQSxDQUZaLENBQUE7QUFBQSxFQUlBLFNBQUEsR0FBZ0IsSUFBQSxDQUFDLENBQUMsRUFBRSxDQUFDLE1BQUwsQ0FBWTtBQUFBLElBQUEsS0FBQSxFQUFPLEtBQVA7R0FBWixDQUpoQixDQUFBO0FBQUEsRUFNQSxTQUFBLEdBQWdCLElBQUEsYUFBQSxDQUFjLElBQWQsRUFBb0IsT0FBcEIsQ0FOaEIsQ0FBQTtBQUFBLEVBT0EsU0FBUyxDQUFDLFNBQVYsQ0FBb0IsZ0JBQXBCLEVBQXNDLGNBQXRDLEVBQXNELGdCQUF0RCxDQVBBLENBRFM7QUFBQSxDQTFGWCxDQUFBOztBQUFBLENBdUdBLENBQUUsbUJBQUYsQ0FBc0IsQ0FBQyxNQUF2QixDQUE4QixDQUFBLFNBQUEsS0FBQSxHQUFBO1NBQUEsU0FBQSxHQUFBO1dBQUcsT0FBQSxDQUFBLEVBQUg7RUFBQSxFQUFBO0FBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUE5QixDQXZHQSxDQUFBOztBQUFBLENBd0dBLENBQUUsaUJBQUYsQ0FBb0IsQ0FBQyxLQUFyQixDQUEyQixDQUFBLFNBQUEsS0FBQSxHQUFBO1NBQUEsU0FBQSxHQUFBO1dBQUcsUUFBQSxDQUFBLEVBQUg7RUFBQSxFQUFBO0FBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUEzQixDQXhHQSxDQUFBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIlxuIyBBbGxvd3MgdG8gbmF2aWdhdGUgZ2l2ZW4gc291cmNlcyBsaW5lcywgc2F2aW5nIG1pbGVzdG9uZXMgdG8gb3B0aW1pemUgcmFuZG9tIHJlYWRpbmdcbiMgb3B0aW9ucyA9IHtcbiMgICAgICAgIG1pbGVzdG9uZXM6IFtdLCAgICAgICAgIC8vIG9wdGlvbmFsOiBhcnJheSBvZiBtaWxlc3RvbmVzLCB3aGljaCBjYW4gYmUgb2J0YWluZWQgYnkgZ2V0TWlsZXN0b25lcygpIG1ldGhvZCBhbmQgc3RvcmVkIHRvIHNwZWVkIHVwIHJhbmRvbSByZWFkaW5nIGluIGZ1dHVyZVxuIyAgICAgICAgY2h1bmtTaXplOiAxMDI0ICogNCwgICAgLy8gb3B0aW9uYWw6IHNpemUgb2YgY2h1bmsgdG8gcmVhZCBhdCBvbmNlXG4jIH1cblxuXG5GaWxlTmF2aWdhdG9yID0gKGZpbGUsIG9wdGlvbnMpIC0+XG4gIHNlbGYgPSB0aGlzXG4gIHNpemUgPSBmaWxlLnNpemVcbiAgZmlsZS5uYXZpZ2F0b3IgPSB0aGlzXG4gICMgcmV1c2UgbWlsZXN0b25lcyBsYXRlclxuICBsYXN0UG9zaXRpb24gPSAwXG5cbiAgZ2V0UHJvZ3Jlc3MgPSAtPlxuICAgIGlmICFzaXplIG9yIHNpemUgPT0gMFxuICAgICAgcmV0dXJuIDBcbiAgICBwcm9ncmVzcyA9IHBhcnNlSW50KDEwMCAqIGxhc3RQb3NpdGlvbiAvIHNpemUpXG4gICAgaWYgcHJvZ3Jlc3MgPiAxMDAgdGhlbiAxMDAgZWxzZSBwcm9ncmVzc1xuXG5cblxuICAjIGNhbGxiYWNrKGVyciwgYnVmZmVyLCBieXRlc1JlYWQpXG5cbiAgcmVhZENodW5rID0gKG9mZnNldCwgbGVuZ3RoLCBjYWxsYmFjaykgLT5cbiAgICBsYXN0UG9zaXRpb24gPSBvZmZzZXQgKyBsZW5ndGhcbiAgICByZWFkZXIgPSBuZXcgRmlsZVJlYWRlclxuXG4gICAgcmVhZGVyLm9ubG9hZGVuZCA9IChwcm9ncmVzcykgLT5cbiAgICAgIGJ1ZmZlciA9IHVuZGVmaW5lZFxuICAgICAgaWYgcmVhZGVyLnJlc3VsdFxuICAgICAgICBidWZmZXIgPSBuZXcgSW50OEFycmF5KHJlYWRlci5yZXN1bHQsIDApXG4gICAgICAgIGJ1ZmZlci5zbGljZSA9IGJ1ZmZlci5zdWJhcnJheVxuICAgICAgY2FsbGJhY2sgcHJvZ3Jlc3MuZXJyLCBidWZmZXIsIHByb2dyZXNzLmxvYWRlZFxuICAgICAgcmV0dXJuXG5cbiAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIgZmlsZS5zbGljZShvZmZzZXQsIG9mZnNldCArIGxlbmd0aClcbiAgICByZXR1cm5cblxuXG5cbiAgIyBjYWxsYmFjayhzdHIpO1xuXG4gIGRlY29kZSA9IChidWZmZXIsIGNhbGxiYWNrKSAtPlxuICAgIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyXG5cbiAgICByZWFkZXIub25sb2FkZW5kID0gKHByb2dyZXNzKSAtPlxuICAgICAgY2FsbGJhY2sgcHJvZ3Jlc3MuY3VycmVudFRhcmdldC5yZXN1bHRcbiAgICAgIHJldHVyblxuXG4gICAgcmVhZGVyLnJlYWRBc1RleHQgbmV3IEJsb2IoWyBidWZmZXIgXSlcbiAgICByZXR1cm5cblxuICBuYXZpZ2F0b3IgPSBuZXcgTGluZU5hdmlnYXRvcihyZWFkQ2h1bmssIGRlY29kZSwgb3B0aW9ucylcblxuXG5cblxuICAjIFJldHVybnMgY3VycmVudCBtaWxlc3RvbmVzLCB0byBzcGVlZCB1cCBmaWxlIHJhbmRvbSByZWFkaW5nIGluIGZ1dHVyZVxuXG4gIHNlbGYuZ2V0TWlsZXN0b25lcyA9IG5hdmlnYXRvci5nZXRNaWxlc3RvbmVzXG5cblxuXG4gICMgUmVhZHMgb3B0aW1hbCBudW1iZXIgb2YgbGluZXNcbiAgIyBjYWxsYmFjazogZnVuY3Rpb24oZXJyLCBpbmRleCwgbGluZXMsIGVvZiwgcHJvZ3Jlc3MpXG4gICMgd2hlcmUgcHJvZ3Jlc3MgaXMgMC0xMDAgJSBvZiBmaWxlIFxuXG4gIHNlbGYucmVhZFNvbWVMaW5lcyA9IChpbmRleCwgY2FsbGJhY2spIC0+XG4gICAgbmF2aWdhdG9yLnJlYWRTb21lTGluZXMgaW5kZXgsIChlcnIsIGluZGV4LCBsaW5lcywgZW9mKSAtPlxuICAgICAgY2FsbGJhY2sgZXJyLCBpbmRleCwgbGluZXMsIGVvZiwgZ2V0UHJvZ3Jlc3MoKVxuICAgICAgcmV0dXJuXG4gICAgcmV0dXJuXG5cblxuXG4gICMgUmVhZHMgZXhhY3QgYW1vdW50IG9mIGxpbmVzXG4gICMgY2FsbGJhY2s6IGZ1bmN0aW9uKGVyciwgaW5kZXgsIGxpbmVzLCBlb2YsIHByb2dyZXNzKVxuICAjIHdoZXJlIHByb2dyZXNzIGlzIDAtMTAwICUgb2YgZmlsZSBcblxuICBzZWxmLnJlYWRMaW5lcyA9IChpbmRleCwgY291bnQsIGNhbGxiYWNrKSAtPlxuICAgIG5hdmlnYXRvci5yZWFkTGluZXMgaW5kZXgsIGNvdW50LCAoZXJyLCBpbmRleCwgbGluZXMsIGVvZikgLT5cbiAgICAgIGNhbGxiYWNrIGVyciwgaW5kZXgsIGxpbmVzLCBlb2YsIGdldFByb2dyZXNzKClcbiAgICAgIHJldHVyblxuICAgIHJldHVyblxuXG5cblxuICAjIEZpbmRzIG5leHQgb2NjdXJyZW5jZSBvZiByZWd1bGFyIGV4cHJlc3Npb24gc3RhcnRpbmcgZnJvbSBnaXZlbiBpbmRleFxuICAjIGNhbGxiYWNrOiBmdW5jdGlvbihlcnIsIGluZGV4LCBtYXRjaHtvZmZzZXQsIGxlbmd0aCwgbGluZX0pXG4gICMgb2Zmc2V0IGFuZCBsZW5ndGggYXJlIGJlbG9uZyB0byBtYXRjaCBpbnNpZGUgbGluZVxuXG4gIHNlbGYuZmluZCA9IG5hdmlnYXRvci5maW5kXG5cblxuXG4gICMgRmluZHMgYWxsIG9jY3VycmVuY2VzIG9mIHJlZ3VsYXIgZXhwcmVzc2lvbiBzdGFydGluZyBmcm9tIGdpdmVuIGluZGV4XG4gICMgY2FsbGJhY2s6IGZ1bmN0aW9uKGVyciwgaW5kZXgsIGxpbWl0SGl0LCByZXN1bHRzKVxuICAjIHJlc3VsdCBpcyBhbiBhcnJheSBvZiBvYmplY3RzIHdpdGggZm9sbG93aW5nIHN0cnVjdHVyZSB7aW5kZXgsIG9mZnNldCwgbGVuZ3RoLCBsaW5lfVxuICAjIG9mZnNldCBhbmQgbGVuZ3RoIGFyZSBiZWxvbmcgdG8gbWF0Y2ggaW5zaWRlIGxpbmVcblxuICBzZWxmLmZpbmRBbGwgPSBuYXZpZ2F0b3IuZmluZEFsbFxuXG5cbiAgIyBSZXR1cm5zIHNpemUgb2YgZmlsZSBpbiBieXRlc1xuICAjIGNhbGxiYWNrOiBmdW5jdGlvbihzaXplKVxuXG4gIHNlbGYuZ2V0U2l6ZSA9IChjYWxsYmFjaykgLT5cbiAgICBjYWxsYmFjayBpZiBmaWxlIHRoZW4gZmlsZS5zaXplIGVsc2UgMFxuXG4gIHJldHVyblxuXG5cbm1vZHVsZS5leHBvcnRzPUZpbGVOYXZpZ2F0b3JcbiIsIkZpbGVOYXZpZ2F0b3IgPSByZXF1aXJlICcuL2ZpbGVuYXZpZ2F0b3IuY29mZmVlJ1xuXG5cbnNob3dfcHJvZ3Jlc3MgPSAocHJvZ3Jlc3MsbnVtYmVyKSAtPlxuICBiYXI9JChcIi5wcm9ncmVzcy1iYXJcIilcbiAgYmFyLmNzcyBcIndpZHRoXCIsIFwiI3twcm9ncmVzc30lXCJcbiAgYmFyLnRleHQgXCIje3Byb2dyZXNzfSVcIlxuICAkKCcjY291bnRlcicpLnRleHQgbnVtYmVyXG4gIGNvbnNvbGUubG9nIFwiI3tudW1iZXJ9IDogbGluZXMgI3twcm9ncmVzc31cIlxuXG4jIEdsb2JhbHNcbmhvc3RzID0gXCJsb2NhbGhvc3Q6OTIwMFwiXG5pbmRleF9uYW1lID0gXCJnb3Z3aWtpXCJcbnR5cGVfbmFtZSA9IFwiZ292c1wiXG5lc19jbGllbnQgPSB1bmRlZmluZWRcbmZpZWxkX25hbWVzID0gW11cblxubmF2aWdhdG9yID0gdW5kZWZpbmVkXG5maWxlID0gdW5kZWZpbmVkXG5saW5lc19pbl9iYXRjaCA9NTAwMFxuaW5kZXhUb1N0YXJ0V2l0aCA9IDBcbm9wdGlvbnMgPSB7Y2h1bmtTaXplOiAxMDI0ICogMTZ9ICMgY2h1bmtTaXplOiAxMDI0ICogMTAyNCAqIDRcblxuXG5pbml0X3VpID0gLT5cbiAgZmlsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaG9vc2VGaWxlQnV0dG9uJykuZmlsZXNbMF1cbiAgc2hvd19wcm9ncmVzcyAwLDBcbiAgXG5cbnByZXBhcmVfanNvbiA9KGluZGV4LCBsaW5lcykgLT5cbiAgaWYgbm90IGxpbmVzIHRoZW4gcmV0dXJuXG4gIHJlcyA9IFtdXG4gIGlmIGluZGV4IGlzIDBcbiAgICBmaWVsZF9uYW1lcyA9IGxpbmVzWzBdLnJlcGxhY2UoL1wiL2csJycpLnNwbGl0ICcsJ1xuICAgIGxpbmVzLnNoaWZ0KClcblxuICBmb3IgbGluZSxpIGluIGxpbmVzXG4gICAgZmllbGRfdmFsdWVzID0gbGluZS5zcGxpdCAnLCdcbiAgICAjcmVjb3JkID0gXy5vYmplY3QgZmllbGRfbmFtZXMsIGZpZWxkX3ZhbHVlc1xuICAgIHJlY29yZCA9IENTVi5wYXJzZShsaW5lLCB7aGVhZGVyOiBmaWVsZF9uYW1lcywgY2VsbERlbGltaXRlcjonLCd9KVxuICAgIGluc3RydWN0ID0geyBpbmRleDogIHsgX2luZGV4OiBpbmRleF9uYW1lLCBfdHlwZTogdHlwZV9uYW1lLCBfaWQ6IGkgfSB9XG4gICAgcmVzLnB1c2ggaW5zdHJ1Y3RcbiAgICByZXMucHVzaCByZWNvcmRcblxuICByZXR1cm4gcmVzXG4gIFxuXG5zZW5kX3RvX3NlcnZlciA9IChpbmRleCwgbGluZXMsIGVvZiwgcHJvZ3Jlc3MsIGpzb24pIC0+XG4gIHNldFRpbWVvdXQgPT5cbiAgICBzaG93X3Byb2dyZXNzKHByb2dyZXNzLCBpbmRleCtsaW5lcy5sZW5ndGgpXG4gICAgY29uc29sZS5sb2cgXCIgI3tsaW5lcy5sZW5ndGh9IGxpbmVzIHNlbnRcIlxuICAgIFxuICAgIGlmIGVvZiB0aGVuIHJldHVyblxuICAgICMgUmVhZGluZyBuZXh0IGNodW5rLCBhZGRpbmcgbnVtYmVyIG9mIGxpbmVzIHJlYWQgdG8gZmlyc3QgbGluZSBpbiBjdXJyZW50IGNodW5rXG4gICAgbmF2aWdhdG9yLnJlYWRMaW5lcyBpbmRleCArIGxpbmVzLmxlbmd0aCwgbGluZXNfaW5fYmF0Y2gsICBsaW5lc1JlYWRIYW5kbGVyXG4gICAgI25hdmlnYXRvci5yZWFkU29tZUxpbmVzIGluZGV4ICsgbGluZXMubGVuZ3RoLCAgbGluZXNSZWFkSGFuZGxlclxuICAgIHJldHVyblxuICAsIDEwMDBcbiAgXG4gICNlc19jbGllbnQuYnVsayB7IGJvZHk6IGpzb24gfSwgKGVyciwgcmVzcCkgPT5cbiAgIyAgaWYgZXJyXG4gICMgICAgYWxlcnQgXCJTb3JyeSwgI3tlcnIubWVzc2FnZX1cIlxuICAjICAgIGNvbnNvbGUubG9nIGVyclxuICAjICAgIHJldHVyblxuICAjICBlbHNlXG4gICMgICAgc2hvd19wcm9ncmVzcyhwcm9ncmVzcywgaW5kZXgrbGluZXMubGVuZ3RoKVxuICAjICAgIGNvbnNvbGUubG9nIFwiICN7bGluZXMubGVuZ3RofSBsaW5lcyBzZW50XCJcbiAgIyAgICBcbiAgIyAgICBpZiBlb2YgdGhlbiByZXR1cm5cbiAgIyAgICAjIFJlYWRpbmcgbmV4dCBjaHVuaywgYWRkaW5nIG51bWJlciBvZiBsaW5lcyByZWFkIHRvIGZpcnN0IGxpbmUgaW4gY3VycmVudCBjaHVua1xuICAjICAgIG5hdmlnYXRvci5yZWFkTGluZXMgaW5kZXggKyBsaW5lcy5sZW5ndGgsIGxpbmVzX2luX2JhdGNoLCAgbGluZXNSZWFkSGFuZGxlclxuICAjICAgICNuYXZpZ2F0b3IucmVhZFNvbWVMaW5lcyBpbmRleCArIGxpbmVzLmxlbmd0aCwgIGxpbmVzUmVhZEhhbmRsZXJcbiAgIyAgICByZXR1cm5cbiAgIyAgcmV0dXJuXG5cbiAgcmV0dXJuXG5cblxucHJvY2Vzc19saW5lcyA9IChpbmRleCwgbGluZXMsIGVvZiwgcHJvZ3Jlc3MpIC0+XG4gIGpzb24gPSBwcmVwYXJlX2pzb24gaW5kZXgsIGxpbmVzXG4gIHNlbmRfdG9fc2VydmVyIGluZGV4LCBsaW5lcywgZW9mLCBwcm9ncmVzcywganNvblxuXG4gIFxuXG5saW5lc1JlYWRIYW5kbGVyID0gKGVyciwgaW5kZXgsIGxpbmVzLCBlb2YsIHByb2dyZXNzKSAtPlxuICBpZiBlcnIgdGhlbiAgcmV0dXJuXG4gIHByb2Nlc3NfbGluZXMgaW5kZXgsIGxpbmVzLCBlb2YsIHByb2dyZXNzXG4gIHJldHVyblxuXG4gIFxucmVhZEZpbGUgPSAtPlxuICBob3N0cyA9ICQoJyNob3N0cycpLnZhbCgpXG4gIGluZGV4X25hbWUgPSAkKCcjaW5kZXhOYW1lJykudmFsKClcbiAgdHlwZV9uYW1lID0gJCgnI3R5cGVOYW1lJykudmFsKClcblxuICBlc19jbGllbnQgPSBuZXcgJC5lcy5DbGllbnQgaG9zdHM6IGhvc3RzXG4gIFxuICBuYXZpZ2F0b3IgPSBuZXcgRmlsZU5hdmlnYXRvcihmaWxlLCBvcHRpb25zKVxuICBuYXZpZ2F0b3IucmVhZExpbmVzIGluZGV4VG9TdGFydFdpdGgsIGxpbmVzX2luX2JhdGNoLCBsaW5lc1JlYWRIYW5kbGVyXG4gICNuYXZpZ2F0b3IucmVhZFNvbWVMaW5lcyBpbmRleFRvU3RhcnRXaXRoLCBsaW5lc1JlYWRIYW5kbGVyXG4gIHJldHVyblxuXG5cbiQoJyNjaG9vc2VGaWxlQnV0dG9uJykuY2hhbmdlID0+IGluaXRfdWkoKVxuJCgnI3JlYWRGaWxlQnV0dG9uJykuY2xpY2sgPT4gcmVhZEZpbGUoKVxuXG5cbiJdfQ==
